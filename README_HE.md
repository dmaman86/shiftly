<div dir="rtl">

# Shiftly - מערכת לניהול שעות וחישוב שכר

[![Live Demo](https://img.shields.io/badge/Live%20Demo-Online-blue)](https://dmaman86.github.io/shiftly/)

> 📘 גרסה באנגלית זמינה כאן: [README.md](./README.md)

מערכת זו היא אפליקציה לניהול שעות עבודה וחישוב שכר מבוססת על **React + TypeScript**.
חישוב שכר כולל משמרות יומיות, ימים מיוחדים, אש״ל, כלכלה וחוקי עבודה מהעולם האמיתי.

הפרויקט שם דגש לא רק על נכונות החישוב, אלא גם על **מידול דומיין ברור, יציבות ארכיטקטונית ותחזוקה ארוכת טווח**.

> ⚠️ המערכת מספקת חישוב אינדיקטיבי בלבד.  
> אין להסתמך על התוצאות לצורכי תלוש שכר רשמי,  
> והן אינן מחליפות חישוב המתבצע על ידי מדור שכר.

---

## עיקרון תכנוני מרכזי

העיקרון המרכזי מאחורי Shiftly הוא ש**לוגיקת החישוב נשארת יציבה לאורך זמן**.

חוקי השכר אינם משתנים לפי מימוש, אלא לפי **הקשר תקופתי**.
תאריכים, שעון קיץ/חורף, שכר שעתי, אש״ל וכלכלה מוגדרים כקלטים ולא כלוגיקה מקודדת.

גישה זו מאפשרת **חישוב לאחור של חודשים קודמים** באמצעות אותו שלד חישוב, רק עם פרמטרים תקופתיים שונים - ללא שינוי בקוד הדומיין.

---

## יכולות עיקריות

- חישוב שכר מבוסס משמרות
- תמיכה ב:
  - ימי עבודה רגילים
  - ימים מיוחדים מלאים (שבת, חגים)
- **זיהוי חגים באמצעות API של Hebcal**
  - פתרון אוטומטי של חגים יהודיים
  - הבחנה בין ימים מיוחדים מלאים למחצית ימי מיוחדים
- ימי מחלה וחופשה
- משמרות החוצות יום
- חישוב אש״ל לפי ציר זמן היסטורי
- חישוב כלכלה (קטנה / גדולה)
- פירוט חודשי מצטבר
- חישוב אינקרמנטלי (הוספה / עדכון / הסרה של משמרות)
- ממשק משתמש ריאקטיבי לחלוטין

---

## סקירת ארכיטקטורה

Shiftly מבוססת על עקרונות **Clean Architecture**, עם הפרדה ברורה בין לוגיקה עסקית, ממשק משתמש, ניהול מצב ושירותים חיצוניים.

המטרה היא לשמור על לוגיקה הדומיין **צםויה, ניתנת לבדיקה ובלתי תלויה בפרימוורקים**.

### זרימת חישוב כללית

משמרת -> יום -> חודש

כל רמה מחושבת בנפרד ומצטברת אופן דטרמיניסטי.

---

## שכבות מערכת

### דומיין

שכבת הדומיין מכילה לוגיקה עסקית טהורה ואינה תלויה בRedux, React או ספריות חיצוניות.

- **Builders**
  בניית מבני נתונים מורכבים ללא חוקים עסקיים.

- **Calculators**
  פונקציות טהורות המממשות חוקי שכר.

- **Reducers**
  צבירה וביטול צבירה של נתונים מחושבים, המאפשרים חישוב אינקרמנטלי.

- **Resolvers**
  לוגיקת החלטה המבוססת על תאריך, זמן והקשר.

- **Factories & Composition**
  חיבור מרכזי של רכיבי הדומיין.

### Adapters

המרת אובייקטי דומיין למודלי תצוגה עבור ה-UI, תוך שמירה על ניתוק מלא מהדומיין.

### Hooks

שכבת תיאום דקה בין ה-UI, הדומיין וה-state.
אינה מכילה לוגיקה עסקית.

### ניהול מצב (Redux)

- ניהול מצב גלובלי וחודשי
- לוגיקה add / subtract דטרמיניסטית
- ללא חישוב מחדש מלא בכל שינוי

Slices מרכזיים:

- `workDaysSlice`
- `globalSlice`

### רכיבי UI

רכיבי תצוגה בלבד.
ה-UI מגיב לנתונים מחושבים ואינם מכיל חוקי שכר.

---

## מושגי דומיין

### Builders

אחראים להרכבת מבני דומיין:

- `ShiftMapBuilder`
- `DayPayMapBuilder`
- `WorkDaysForMonthBuilder`

### Calculators

לוגיקת חישוב טהורה:

- שעות רגילות (לפי משמרת / יום)
- שעות נוספות ומיוחדות
- חישוב אש״ל (משמרת / יום / חודש)
- חישוב כלכלה (קטנה / גדולה)

### Reducers

צבירה והפחתה של נתונים:

- Reducer חודשי לשכר
- צובר שעות רגילות
- Reducers למקטעים קבועים

### Resolvers

לוגיקת החלטה תלוית הקשר:

- Resolver חגים (Hebcal)
- Resolver מקטעי משמרת
- Resolver תעריפים מבוססי ציר זמן

---

## טכנולוגיות

- React
- TypeScript
- Redux Toolkit
- MUI (Material UI) & Bootstrap
- Vite
- Hebcal API

---

## מבנה הפרויקט (מקוצר)

```plaintext
src/
├── domain/         # לוגיקה עסקית - בלתי תלויה בפריימוורקים
│ ├── builder/
│ ├── calculator/
│ ├── reducer/
│ ├── resolve/
│ ├── factory/
│ └── types/
├── adapters/       # המרה הדומיין ל-UI
├── hooks/          # שכבת תיאום
├── redux/          # ניהול מצב גלובלי
├── components/     # רכיבי UI
├── pages/          # תצוגות יומיות וחודשיות
├── context/        # חיבור וספקי דומיין
└── utils/          # עזרי תשתית
```

---

## התנהגות ממשק המשתמש

## תצוגות מערכת

Shiftly כוללת שתי תצוגות חישוב עיקריות:

### תצוגה יומית

- מיועדת להזנת משמרות יומיות
- מאפשרת הוספה, עריכה ובקרה של משמרות
- מציגה פירוק שכר יומי
- הסיכום החודשי מתעדכן באופן אינקרמנטלי

### תצוגה חודשית

- מיועדת לניתוח שכר חודשי מצטבר
- מחייבת בחירת שנה וחודש
- מבטיחה דיוק תעריפי אש״ל וכלכלה לפי התקופה
- מציגה סיכום חודשי קומפקטי וברור

שתי התצוגות משתמשות באותו מנגנון חישוב דומיין.
רק ההקשר וההצגה משתנים.

### פאנל הגדרות (ConfigPanel)

רכיב ה־`ConfigPanel` מותאם להקשר הפעיל:

- **בתצוגה יומית**:

  - הגדרת שעות תקן ושכר שעתי
  - החישוב החודשי נגזר מהנתונים היומיים

- **בתצוגה חודשית**:
  - בחירת שנה וחודש היא הכרחית
  - מבטיחה תעריפי אש״ל וכלכלה מדויקים לפי התקופה
  - מחייבת הגדרת שכר שעתי לצורך חישוב

הפרדה זו מונעת חישוב שגוי ומחדדת אחריות.

### תצוגת יום עבודה

- אם `baseRate` **לא הוגדר**: מוצגות רק שעות העבודה.
- אם `baseRate` **הוגדר**: מוצג שכר יומי וסיכום חודשי.
- **ימי מחלה / חופשה**: לא מאפשרים הזנת משמרות.
- **שבת / חג**: מאפשרים עבודה בלבד (ללא היעדרות).
- **משמרת חוצה יום**: דורשת אישור מפורש מהמשתמש.

### לוגיקת הגדרת יום עבודה

**שבת או חג - עבודה מותרת**

- לא ניתן לסמן יום כמחלה או חופש, אך ניתן להזין משמרות עבודה.
  ![Shabbat Sick Vacation Example](./.github/assets/shabbat-sick-vacation.png)

**יום מחלה או חופש - ללא משמרות עבודה**

- כאשר יום מסומן כמחלה או חופש, לא ניתן להזין בו משמרות עבודה
  ![Sick Select Example](./.github/assets/sick-day-select.png)
  ![Vacation Select Example](./.github/assets/vacation-day-select.png)

**משמרת חוצה יום - תיבת סימון ״חוצה יום״**

- כאשר שעת הסיום היא ביום הבא המערכת מבקשת אישור מפורש על חציית יום.
  ![Cross Day Warning](./.github/assets/cross-day-warning.png)
  ![Cross Day Checkbox](./.github/assets/cross-day-checkbox.png)
  ![Cross Day](./.github/assets/shift-save.png)

**סיכום פירוק יומי**
![Breakdown Day 1](./.github/assets/breakdown-summary-1.png)
![Breakdown Day 2](./.github/assets/breakdown-summary-2.png)

**סיכום חודשי**
![Monthly Summary](./.github/assets/monthly-summary.png)

---

## למה ארכיטקטורה זו?

הארכיטקטורה נבחרה כדי להתמודד עם:

- חוקי שכר מורכבים
- מקרי קצה מבוססי זמן
- רמות צבירה שונות (משמרת → יום → חודש)
- חישוב אינקרמנטלי ללא חישוב מחדש מלא

היא מאפשרת התפתחות עתידית של המערכת **בלי להעמיס לוגיקה מותנית ברכיבי ה-UI**.

---

## הערות

- כל האחוזים מנורמלים (לדוגמה: `1`, `1.25`, `1.5`, `0.2`)
- לוגיקת הדומיין אינה תלויה בפריימוורק
- ה־UI אינו מכיל חוקים עסקיים

---

## התחלה מהירה

```bash
git clone https://github.com/dmaman86/shiftly.git
cd shiftly
npm install
npm run dev
```

כניסה ל־`http://localhost:5173/shiftly` בדפדפן.

---

## רישיון

הפרויקט מופץ תחת רישיון [MIT](LICENSE).

</div>

